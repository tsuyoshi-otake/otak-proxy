# Implementation Plan

- [-] 1. 出力チャネル管理の実装




- [x] 1.1 OutputChannelManagerクラスを作成

  - シングルトンパターンで出力チャネルを管理
  - エラー、情報、警告の詳細情報を記録するメソッドを実装
  - 出力チャネルの表示とクリア機能を実装
  - _Requirements: 3.2, 3.3, 3.4_

- [x] 1.2 OutputChannelManagerのユニットテストを作成


  - 詳細情報の記録機能をテスト
  - 出力チャネルの表示とクリア機能をテスト
  - _Requirements: 3.2, 3.3, 3.4_

- [x] 1.3 プロパティテストを作成: 出力チャネルの完全性



  - **Property 4: 出力チャネルの完全性**
  - **Validates: Requirements 3.3, 3.4**
  - ランダムなエラー詳細情報を生成し、出力チャネルに記録される情報が完全であることを確認
  - 最小100回のイテレーション


- [x] 2. メッセージフォーマッターの実装



- [x] 2.1 NotificationFormatterクラスを作成

  - メッセージを200文字以内に要約する機能を実装
  - 提案を最大3つに要約する機能を実装
  - URLリストを最大2つに要約する機能を実装
  - エラーメッセージをフォーマットする機能を実装
  - _Requirements: 1.1, 1.2, 1.3, 1.4_

- [x] 2.2 NotificationFormatterのユニットテストを作成


  - メッセージ要約機能をテスト
  - 提案要約機能をテスト
  - URLリスト要約機能をテスト
  - エラーメッセージフォーマット機能をテスト
  - _Requirements: 1.1, 1.2, 1.3, 1.4_


- [x] 2.3 プロパティテストを作成: メッセージ長制限

  - **Property 1: メッセージ長制限**
  - **Validates: Requirements 1.4**
  - ランダムな長さのメッセージを生成し、要約後のメッセージが200文字以内であることを確認
  - 最小100回のイテレーション

- [x] 2.4 プロパティテストを作成: 提案の要約


  - **Property 2: 提案の要約**
  - **Validates: Requirements 1.2**
  - ランダムな数の提案を生成し、要約後の提案が最大3つまでであることを確認
  - 最小100回のイテレーション

- [x] 2.5 プロパティテストを作成: URLリストの要約



  - **Property 3: URLリストの要約**
  - **Validates: Requirements 1.3**
  - ランダムな数のURLを生成し、要約後のURLが最大2つまでであることを確認
  - 最小100回のイテレーション



- [x] 3. 通知スロットラーの実装


- [x] 3.1 NotificationThrottlerクラスを作成


  - 通知の重複を抑制する機能を実装
  - タイムアウトを管理する機能を実装
  - 連続失敗の通知制御機能を実装
  - クリア機能を実装
  - _Requirements: 7.1, 7.2, 7.3, 7.4_

- [x] 3.2 NotificationThrottlerのユニットテストを作成


  - 通知の重複抑制機能をテスト
  - タイムアウト管理機能をテスト
  - 連続失敗の通知制御機能をテスト
  - クリア機能をテスト
  - _Requirements: 7.1, 7.2, 7.3, 7.4_

- [x] 3.3 プロパティテストを作成: 通知の重複抑制


  - **Property 5: 通知の重複抑制**
  - **Validates: Requirements 7.1, 7.2, 7.3**
  - ランダムなメッセージとタイミングを生成し、同じメッセージが指定時間内に複数回表示されないことを確認
  - 最小100回のイテレーション

- [x] 3.4 プロパティテストを作成: 連続失敗の通知制御


  - **Property 6: 連続失敗の通知制御**
  - **Validates: Requirements 7.4**
  - ランダムな数の連続失敗を生成し、通知が最初と5回目のみ表示されることを確認
  - 最小100回のイテレーション

- [x] 4. UserNotifierの拡張




- [x] 4.1 UserNotifierに新しいメソッドを追加


  - showErrorWithDetailsメソッドを実装（詳細情報付きエラー通知）
  - showProgressNotificationメソッドを実装（進行状況通知）
  - 既存のメソッドを改善（OutputChannelManager、NotificationThrottler、NotificationFormatterを統合）
  - 自動閉じる機能を実装（タイムアウト管理）
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 2.1, 2.2, 2.3, 2.4, 3.1, 3.2, 4.1, 4.3_

- [x] 4.2 UserNotifierのユニットテストを作成


  - showErrorWithDetailsメソッドをテスト
  - showProgressNotificationメソッドをテスト
  - 自動閉じる機能をテスト
  - 既存のメソッドの改善をテスト
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 2.1, 2.2, 2.3, 2.4, 3.1, 3.2, 4.1, 4.3_

- [x] 5. 国際化メッセージの追加




- [x] 5.1 新しいメッセージキーを追加


  - en.jsonとja.jsonに新しいメッセージキーを追加
  - 「詳細を表示」、「再テスト」、「設定を変更」、「再検出」などのアクションボタンのラベルを追加
  - 進行状況メッセージのテンプレートを追加
  - _Requirements: 3.1, 4.2, 6.1, 6.2, 6.3_

- [x] 6. コマンドの更新




- [x] 6.1 TestProxyCommandを更新


  - 新しいUserNotifierのメソッドを使用
  - 進行状況通知を表示
  - エラー時に詳細情報を出力チャネルに記録
  - アクションボタンを追加（「再テスト」、「設定を変更」）
  - _Requirements: 1.1, 1.3, 3.3, 3.4, 4.1, 4.2, 4.3, 6.2_

- [x] 6.2 プロパティテストを作成: 進行状況メッセージの正確性


  - **Property 7: 進行状況メッセージの正確性**
  - **Validates: Requirements 4.2**
  - ランダムな数のURLを生成し、進行状況メッセージに正しい番号が含まれることを確認
  - 最小100回のイテレーション

- [x] 6.2 ToggleProxyCommandを更新


  - 新しいUserNotifierのメソッドを使用
  - エラー時に詳細情報を出力チャネルに記録
  - アクションボタンを追加（「手動設定」、「システムからインポート」）
  - _Requirements: 1.1, 3.3, 6.1_

- [x] 6.3 ConfigureUrlCommandを更新


  - 新しいUserNotifierのメソッドを使用
  - エラー時に詳細情報を出力チャネルに記録
  - _Requirements: 1.1, 3.3_

- [x] 6.4 ImportProxyCommandを更新


  - 新しいUserNotifierのメソッドを使用
  - エラー時に詳細情報を出力チャネルに記録
  - アクションボタンを追加（「手動設定」、「再検出」）
  - _Requirements: 1.1, 3.3, 6.3_

- [ ] 7. StatusBarManagerの改善


- [ ] 7.1 ツールチップを簡潔にする
  - エラーメッセージを1行で表示
  - コマンドリンクを視覚的に区別
  - 不要な情報を削除
  - _Requirements: 8.1, 8.2, 8.3, 8.4_

- [ ] 7.2 StatusBarManagerのユニットテストを更新
  - ツールチップの内容をテスト
  - エラーメッセージの表示形式をテスト
  - _Requirements: 8.1, 8.2, 8.3, 8.4_



- [x] 8. Loggerの統合


- [x] 8.1 LoggerをOutputChannelManagerと統合


  - Loggerの出力を出力チャネルにも記録
  - 既存のコンソールログ機能を維持
  - _Requirements: 3.2, 3.3_



- [x] 9. チェックポイント - すべてのテストが通ることを確認



  - すべてのテストが通ることを確認し、問題があればユーザーに質問する



- [x] 10. 統合テストの作成



- [x] 10.1 通知フロー全体の統合テストを作成


  - エラー発生 → 通知表示 → 詳細表示ボタンクリック → 出力チャネル表示のフローをテスト
  - _Requirements: 1.1, 3.1, 3.2_


- [x] 10.2 重複抑制フローの統合テストを作成





  - 同じエラーを短時間に複数回発生 → 通知が1回のみ表示 → 出力チャネルにすべて記録のフローをテスト
  - _Requirements: 7.1, 7.2_



- [x] 10.3 進行状況フローの統合テストを作成




  - プロキシテスト開始 → 進行状況通知表示 → テスト完了 → 結果通知表示のフローをテスト

  - _Requirements: 4.1, 4.2, 4.3_



- [x] 11. 最終チェックポイント - すべてのテストが通ることを確認






  - すべてのテストが通ることを確認し、問題があればユーザーに質問する
